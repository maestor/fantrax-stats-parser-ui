/* You can add global styles to this file, and also import other style files */
// Mobile viewport helpers
// - 100vh is unreliable on mobile browsers (address bar / bottom bar).
// - Prefer 100dvh when supported.
:root {
  --app-height: 100vh;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-top: env(safe-area-inset-top, 0px);
}

@supports (height: 100dvh) {
  :root {
    --app-height: 100dvh;
  }
}

html,
body {
  height: 100%;
}
body {
  margin: 0;
  font-family: Roboto, "Helvetica Neue", sans-serif;
  background-color: var(--mat-sys-surface);
  color: var(--mat-sys-on-surface);
}

// Material: ensure overlays/dialogs/tabs/toggles follow theme tokens.
// Some MDC-based components can look incorrect in dark mode if defaults bleed through.

.cdk-overlay-container {
  color: var(--mat-sys-on-surface);
}

// Dialog close buttons (and similar icon-buttons rendered in overlays) should always
// inherit the correct token color, regardless of component-specific wrappers.
.cdk-overlay-container .mat-mdc-dialog-container button[mat-icon-button],
.cdk-overlay-container .mat-mdc-dialog-container .mat-mdc-icon-button {
  color: var(--mat-sys-on-surface) !important;
}

// Backdrop: keep a consistent, not-too-heavy overlay.
.cdk-overlay-backdrop {
  background: rgb(0 0 0 / 0.4) !important;
}

@media (prefers-color-scheme: dark) {
  .cdk-overlay-backdrop {
    background: rgb(0 0 0 / 0.55) !important;
  }
}

// Dialog surfaces (player card + help dialog) should not default to white.
.mat-mdc-dialog-container .mdc-dialog__surface {
  background-color: var(--mat-sys-surface-container-high) !important;
  color: var(--mat-sys-on-surface) !important;
}

// Cards are used in dialogs (player card) and should not default to white.
.mat-mdc-card {
  background-color: var(--mat-sys-surface-container-high);
  color: var(--mat-sys-on-surface);
}

// Dropdown/menu/autocomplete panels (rendered in cdk overlay).
.mat-mdc-select-panel,
.mat-mdc-menu-panel,
.mat-mdc-autocomplete-panel,
.mat-datepicker-content {
  background-color: var(--mat-sys-surface-container-high) !important;
  color: var(--mat-sys-on-surface) !important;
}

.mat-mdc-option,
.mat-mdc-menu-item,
.mat-mdc-autocomplete-panel .mat-mdc-option {
  color: var(--mat-sys-on-surface) !important;
}

.mat-mdc-option:hover:not(.mdc-list-item--disabled),
.mat-mdc-menu-item:hover:not(.mat-mdc-menu-item-disabled) {
  background-color: var(--mat-sys-surface-container-highest) !important;
}

.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled) {
  background-color: var(--mat-sys-primary-container) !important;
  color: var(--mat-sys-on-primary-container) !important;
}

// Form fields (selects + search): prevent light containers in dark mode.
.mat-mdc-form-field .mat-mdc-text-field-wrapper {
  background-color: var(--mat-sys-surface-container-high) !important;
  color: var(--mat-sys-on-surface) !important;
}

.mat-mdc-form-field .mdc-floating-label {
  color: var(--mat-sys-on-surface-variant) !important;
}

.mat-mdc-form-field .mat-mdc-input-element,
.mat-mdc-form-field .mat-mdc-select-min-line,
.mat-mdc-form-field .mat-mdc-select-value-text {
  color: var(--mat-sys-on-surface) !important;
}

.mat-mdc-form-field .mat-mdc-select-arrow {
  color: var(--mat-sys-on-surface-variant) !important;
}

// Tabs: avoid black-on-black by explicitly mapping to system tokens.
.mat-mdc-tab-header {
  background-color: var(--mat-sys-surface-container);
  border-bottom: 1px solid var(--mat-sys-outline-variant);
}

.mat-mdc-tab .mdc-tab__text-label,
.mat-mdc-tab-header .mdc-tab__text-label {
  color: var(--mat-sys-on-surface-variant) !important;
}

.mat-mdc-tab.mdc-tab--active .mdc-tab__text-label,
.mat-mdc-tab-header .mdc-tab--active .mdc-tab__text-label {
  color: var(--mat-sys-on-surface) !important;
}

// Focus rings: some MDC focus indicators are too subtle in dark mode.
// Tabs: match the light-mode behavior (subtle focused background), avoid circular rings.
.mat-mdc-tab-header .mdc-tab:focus-visible {
  background-color: color-mix(
    in srgb,
    var(--mat-sys-primary) 12%,
    var(--mat-sys-surface-container)
  );
}

// Hover states: Angular Material state layers can be subtle in dark mode.
// Make hover affordances more obvious, but only on hover-capable pointers.
@media (prefers-color-scheme: dark) {
  @media (hover: hover) and (pointer: fine) {
    .mat-mdc-tab-header .mdc-tab:not(.mdc-tab--active):hover {
      background-color: color-mix(
        in srgb,
        var(--mat-sys-primary) 6%,
        var(--mat-sys-surface-container)
      );
    }

    .mat-mdc-tab-header .mdc-tab.mdc-tab--active:hover {
      background-color: color-mix(
        in srgb,
        var(--mat-sys-primary) 10%,
        var(--mat-sys-surface-container)
      );
    }

    button[mat-icon-button]:not([disabled]):hover,
    .mat-mdc-icon-button:not(.mat-mdc-button-disabled):hover {
      background-color: color-mix(in srgb, var(--mat-sys-primary) 14%, transparent);
    }
  }
}

// Icon buttons (close buttons, info icon, etc.)
button[mat-icon-button]:focus-visible,
.mat-mdc-icon-button:focus-visible {
  outline: 2px solid color-mix(in srgb, var(--mat-sys-primary) 70%, transparent);
  outline-offset: 3px;
}

// Checkboxes (graphs + elsewhere)
@supports selector(:has(*)) {
  .mat-mdc-checkbox:has(.mdc-checkbox__native-control:focus-visible) .mdc-checkbox__background {
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--mat-sys-primary) 55%, transparent);
    border-radius: 4px;
  }

  // Focus outline for the whole checkbox row (checkbox + label), drawn INSIDE to avoid clipping.
  .mat-mdc-checkbox:has(.mdc-checkbox__native-control:focus-visible) .mdc-form-field {
    box-sizing: border-box;
    padding-right: 8px;
    border-radius: 12px;
    background-color: color-mix(in srgb, var(--mat-sys-primary) 7%, transparent);
    box-shadow: inset 0 0 0 2px color-mix(in srgb, var(--mat-sys-primary) 55%, transparent);
  }
}

@supports not selector(:has(*)) {
  .mat-mdc-checkbox:focus-within .mdc-checkbox__background {
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--mat-sys-primary) 55%, transparent);
    border-radius: 4px;
  }

  .mat-mdc-checkbox:focus-within .mdc-form-field {
    box-sizing: border-box;
    padding-right: 8px;
    border-radius: 12px;
    background-color: color-mix(in srgb, var(--mat-sys-primary) 7%, transparent);
    box-shadow: inset 0 0 0 2px color-mix(in srgb, var(--mat-sys-primary) 55%, transparent);
  }
}

// Button toggles (report type): make inactive readable and active high-contrast.
.mat-button-toggle-group {
  background-color: var(--mat-sys-surface-container) !important;
  border: 1px solid var(--mat-sys-outline-variant) !important;
}

.mat-button-toggle {
  color: var(--mat-sys-on-surface) !important;
}

.mat-button-toggle-checked {
  background-color: var(--mat-sys-primary-container) !important;
  color: var(--mat-sys-on-primary-container) !important;
}

// The checkmark shown on selected toggles should match the selected text color.
// Material uses a pseudo-checkbox with its own internal styles; use high specificity.
.mat-button-toggle-group .mat-button-toggle .mat-pseudo-checkbox {
  color: currentColor !important;
  border-color: currentColor !important;
}

.mat-button-toggle-group .mat-button-toggle-checked .mat-pseudo-checkbox {
  color: currentColor !important;
  border-color: currentColor !important;
  opacity: 1 !important;
}

// Checkmark stroke is typically drawn using borders on a pseudo-element.
.mat-button-toggle-group .mat-button-toggle-checked .mat-pseudo-checkbox::after {
  border-color: currentColor !important;
  opacity: 1 !important;
}

// Some variants use an additional "checked" class.
.mat-button-toggle-group .mat-button-toggle-checked .mat-pseudo-checkbox.mat-pseudo-checkbox-checked {
  color: currentColor !important;
  border-color: currentColor !important;
  opacity: 1 !important;
}

// Material's "minimal" pseudo-checkbox uses a CSS variable for the checkmark.
// Override it for checked toggles so it stays readable (matches selected text).
.mat-button-toggle-group .mat-button-toggle-checked .mat-pseudo-checkbox-minimal {
  --mat-pseudo-checkbox-minimal-selected-checkmark-color: currentColor;
}

.mat-button-toggle-group .mat-button-toggle-checked .mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after {
  color: currentColor !important;
}

// If the selected indicator is rendered as an icon instead of a pseudo-checkbox.
.mat-button-toggle-group .mat-button-toggle-checked mat-icon,
.mat-button-toggle-group .mat-button-toggle-checked .mat-icon {
  color: currentColor !important;
  opacity: 1 !important;
}

.mat-button-toggle-button {
  color: inherit !important;
}

.mat-button-toggle-label-content {
  color: inherit !important;
}

@media (prefers-color-scheme: dark) {
  // Slides toggles (points per game): ensure readable + modern dark styling.
  .mat-mdc-slide-toggle .mdc-switch__track {
    background-color: var(--mat-sys-surface-container-high) !important;
  }

  .mat-mdc-slide-toggle .mdc-switch__handle {
    background-color: var(--mat-sys-on-surface-variant) !important;
  }

  .mat-mdc-slide-toggle.mat-mdc-slide-toggle-checked .mdc-switch__track {
    background-color: var(--mat-sys-primary) !important;
  }

  .mat-mdc-slide-toggle.mat-mdc-slide-toggle-checked .mdc-switch__handle {
    background-color: var(--mat-sys-on-primary) !important;
  }

  .mat-mdc-slide-toggle .mdc-form-field > label {
    color: var(--mat-sys-on-surface) !important;
  }
}

// Help dialog: ensure title/body text uses on-surface (defaults can be too dark).
.help-dialog {
  button[mat-icon-button],
  .mat-mdc-icon-button {
    color: var(--mat-sys-on-surface) !important;
  }

  .mdc-dialog__title,
  .mdc-dialog__content,
  .mat-mdc-dialog-title,
  .mat-mdc-dialog-content {
    color: var(--mat-sys-on-surface) !important;
  }

  // Dialog action (e.g. "Sulje") should use a readable accent in dark mode.
  .mat-mdc-dialog-actions .mat-mdc-button,
  .mat-mdc-dialog-actions .mat-mdc-unelevated-button,
  .mat-mdc-dialog-actions .mat-mdc-outlined-button,
  .mat-mdc-dialog-actions a {
    color: var(--mat-sys-primary) !important;
  }
}

// Player card graphs: checkbox labels and boxes need contrast in dark mode.
.player-card-dialog {
  button[mat-icon-button],
  .mat-mdc-icon-button {
    color: var(--mat-sys-on-surface) !important;
  }

  .mat-mdc-checkbox .mdc-form-field > label {
    color: var(--mat-sys-on-surface) !important;
  }

  .mat-mdc-checkbox .mdc-checkbox__background {
    border-color: var(--mat-sys-outline) !important;
  }

  .mat-mdc-checkbox.mat-mdc-checkbox-checked .mdc-checkbox__background {
    background-color: var(--mat-sys-primary) !important;
    border-color: var(--mat-sys-primary) !important;
  }

  .mat-mdc-checkbox.mat-mdc-checkbox-checked .mdc-checkbox__checkmark-path {
    stroke: var(--mat-sys-on-primary) !important;
  }
}

.sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

.skip-link {
  position: absolute;
  left: 8px;
  top: 8px;
  z-index: 10000;
  padding: 8px 12px;
  border-radius: 6px;
  background: var(--mat-sys-surface);
  color: var(--mat-sys-on-surface);
  box-shadow: var(--mat-sys-level2);
  transform: translateY(-200%);
  transition: transform 120ms ease-in-out;
}

.skip-link:focus {
  transform: translateY(0);
  outline: 2px solid currentColor;
  outline-offset: 2px;
}
.content {
  margin: 12px auto;
  max-width: 1170px;
}

.center {
  text-align: center;
}

/* Player card dialog styles */
.player-card-dialog {
  .mat-mdc-dialog-container {
    max-width: 95vw !important;
    width: auto !important;
    max-height: calc(var(--app-height) - 16px) !important;

    .mdc-dialog__surface {
      max-width: 95vw !important;
      width: auto !important;
      max-height: calc(var(--app-height) - 16px) !important;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }
  }

  // Mobile: ensure consistent 95vw width and remove padding
  @media (max-width: 768px) {
    .mat-mdc-dialog-container {
      max-width: 95vw !important;
      width: 95vw !important;
      padding: 0 !important;
      max-height: calc(var(--app-height) - 8px) !important;

      .mdc-dialog__surface {
        max-width: 95vw !important;
        width: 95vw !important;
        padding: 0 !important;
        max-height: calc(var(--app-height) - 8px) !important;
      }
    }
  }
}

/* Help dialog styles */
.help-dialog {
  .mat-mdc-dialog-container {
    max-width: 95vw !important;
    width: auto !important;
    max-height: calc(var(--app-height) - 16px) !important;

    .mdc-dialog__surface {
      width: min(720px, 95vw) !important;
      max-width: 95vw !important;
      max-height: calc(var(--app-height) - 16px) !important;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }
  }

  @media (max-width: 768px) {
    .mat-mdc-dialog-container {
      max-width: 95vw !important;
      max-height: calc(var(--app-height) - 8px) !important;

      .mdc-dialog__surface {
        width: 95vw !important;
        max-height: calc(var(--app-height) - 8px) !important;
      }
    }
  }
}

.mat-elevation-z1 {
  box-shadow: var(--mat-sys-level1);
}
.mat-elevation-z2 {
  box-shadow: var(--mat-sys-level2);
}
.mat-elevation-z3 {
  box-shadow: var(--mat-sys-level3);
}
.mat-elevation-z4 {
  box-shadow: var(--mat-sys-level4);
}
.mat-elevation-z5 {
  box-shadow: var(--mat-sys-level5);
}

// Mobile: smaller h1 title
@media (max-width: 768px) {
  h1 {
    font-size: 1.5em !important;
    margin: 1em 0 0 0 !important;
  }
}
